@(logic: wizard.controller.aGameLogic)(implicit request: play.api.mvc.RequestHeader)

@main("Ingame") {

    @defining((card: wizard.model.cards.Card) => {
        card.value match {
            case wizard.model.cards.Value.WizardKarte => "Wizard.png"
            case wizard.model.cards.Value.Chester     => "Jester.png"
            case v =>
                val colorName = card.color.toString   // "Red", "Green", "Blue", "Yellow"
                val number    = v.cardType()          // "1".."13"
                s"${colorName}_${number}.png"
        }
    }) { cardToFile =>

        @defining(request.cookies.get("theme").map(_.value).getOrElse("auto")) { theme =>
            <main class="game__main bg-ingame" style='background-image: url("@{
                theme match {
                    case "light" => routes.Assets.versioned("images/backgrounds/Wizard_game_background_light.png")
                    case _        => routes.Assets.versioned("images/backgrounds/Wizard_game_background2_GUI.png")
                }
            }")'>
        }
            @logic.getPlayer.map { players =>
                <aside class="game__scoreboard" aria-live="polite">
                    <div class="title">Runde</div>
                    <div class="score-grid">
                        <div class="hdr">Spieler</div>
                        <div class="hdr">Bid</div>
                        <div class="hdr">Punkte</div>
                        @for(p <- players) {
                            <div>@p.name</div>
                            <div class="val">@p.roundBids</div>
                            <div class="val">@p.points</div>
                        }
                    </div>
                </aside>
            }

            <div class="game__row">
                @logic.getTrumpCard.map { trump =>
                <section class="game__section" aria-label="Trumpf">
                    <div class="title">Trumpf:
                        @{ trump.value match {
                            case wizard.model.cards.Value.WizardKarte => "Wizard"
                            case wizard.model.cards.Value.Chester     => "Jester"
                            case _                                    => trump.color.toString
                        }
                        }
                        </div>
                    <div class="game__cards">
                        <img loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(trump))' alt='@trump.toString' />
                    </div>
                </section>
                }.getOrElse {
                    <section class="game__section" aria-label="Trumpf">
                        <div class="title">Trumpf: —</div>
                    </section>
                }

                @logic.getTrickCards.filter(_.nonEmpty).map { cards =>
                <section class="game__section" aria-label="Aktueller Stich">
                    <div class="title">Aktueller Stich:</div>
                    <div class="game__cards">
                        @for(card <- cards) {
                            <img loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />
                        }
                    </div>
                </section>
                }.getOrElse {
                    <section class="game__section" aria-label="Aktueller Stich">
                        <div class="title">Aktueller Stich:</div>
                    </section>
                }
            </div>

            @logic.getPlayer.foreach { players =>
                <section class="game__section" aria-label="Spielerübersicht">
                    <div class="title">Spieler:</div>
                    <div>@players.map(_.name).mkString(", ")</div>
                </section>
            }

            @for(player <- logic.getPlayer.getOrElse(Nil)) {
                <section class="game__section game__hand" aria-label="Hand von @player.name">
                    <div class="player-name">@player.name</div>
                    <div class="game__cards">
                    @for((card, idx) <- player.hand.cards.zipWithIndex) {
                        <a href="@routes.HomeController.demoOffer(s"${idx + 1}")">
                            <img loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />
                        </a>
                    }
                    </div>
                </section>
            }

        </main>

    }
}