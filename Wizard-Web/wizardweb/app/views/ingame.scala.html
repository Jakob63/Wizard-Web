@(logic: wizard.controller.aGameLogic)(implicit request: play.api.mvc.RequestHeader)

@main("Ingame") {

    @defining((card: wizard.model.cards.Card) => {
        card.value match {
            case wizard.model.cards.Value.WizardKarte => "Wizard.png"
            case wizard.model.cards.Value.Chester => "Jester.png"
            case v =>
                val colorName = card.color.toString
                val number = v.cardType()
                s"${colorName}_${number}.png"
        }
    }) { cardToFile =>

        @defining(request.cookies.get("theme").map(_.value).getOrElse("auto")) { theme =>
            @defining({
                val light = routes.Assets.versioned("images/backgrounds/Wizard_game_background_light.png").url
                val dark = routes.Assets.versioned("images/backgrounds/Wizard_game_background2_GUI.png").url
                if(theme == "light") light else dark
            }) { bgUrl =>

                <main class="game__main bg-ingame" style='@{s"background-image: url(\'$bgUrl\')"}'>
                    <div class="container-xxl py-3">

                    <div class="game__row row gx-5 gy-5 align-items-stretch mb-4">
                        @logic.getTrumpCard.map { trump =>
                            <div class="col-12 col-md-4 col-lg-3">
                                <section class="game__section game__section--trump" aria-label="Trumpf">
                                    <div class="title">Trumpf:
                                        @{
                                            trump.value match {
                                                case wizard.model.cards.Value.WizardKarte => "Wizard"
                                                case wizard.model.cards.Value.Chester => "Jester"
                                                case _ => trump.color.toString
                                            }
                                        }
                                    </div>
                                    <div class="game__cards">
                                        <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(trump))' alt='@trump.toString' />
                                    </div>
                                </section>
                            </div>
                        }.getOrElse {
                            <div class="col-12 col-md-4 col-lg-3">
                                <section class="game__section game__section--trump" aria-label="Trumpf">
                                    <div class="title">Trumpf: —</div>
                                </section>
                            </div>
                        }

                        @logic.getTrickCards.filter(_.nonEmpty).map { cards =>
                            <div class="col-12 col-md-8 col-lg-6">
                                <section class="game__section" aria-label="Aktueller Stich">
                                    <div class="title">Aktueller Stich:</div>
                                    <div class="game__cards">
                                        @for(card <- cards) {
                                            <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />
                                        }
                                    </div>
                                </section>
                            </div>
                        }.getOrElse {
                            <div class="col-12 col-md-8 col-lg-6">
                                <section class="game__section" aria-label="Aktueller Stich">
                                    <div class="title">Aktueller Stich:</div>
                                </section>
                            </div>
                        }

                        @logic.getPlayer.map { players =>
                            <div class="col-12 col-md-4 col-lg-3">
                                <section class="game__section game__section--scoreboard" aria-label="Scoreboard">
                                    <div class="game__scoreboard">
                                        <div class="title">Runde</div>
                                        <div class="score-grid">
                                            <div class="hdr">Spieler</div>
                                            <div class="hdr">Bid</div>
                                            <div class="hdr">Punkte</div>
                                            @for(p <- players) {
                                                <div>@p.name</div>
                                                <div class="val">@p.roundBids</div>
                                                <div class="val">@p.points</div>
                                            }
                                        </div>
                                    </div>
                                </section>
                            </div>
                        }
                    </div>
                    @logic.getPlayer.foreach { players =>
                        <section class="game__section" aria-label="Spielerübersicht">
                            <div class="title">Spieler:</div>
                            <div>@players.map(_.name).mkString(", ")</div>
                        </section>
                    }

                    @for(player <- logic.getPlayer.getOrElse(Nil)) {
                        <section class="game__section game__hand d-flex align-items-center" aria-label="Hand von @player.name">                            <div class="player-name text-nowrap">@player.name</div>
                            <div class="game__cards d-flex flex-nowrap overflow-auto">                            @for((card, idx) <- player.hand.cards.zipWithIndex) {
                                <a href="@routes.HomeController.demoOffer(s"${idx + 1}")">
                                    <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />                                </a>
                            }
                            </div>
                        </section>
                    }

                                    </div>
                                </main>

            }
        }
    }
}