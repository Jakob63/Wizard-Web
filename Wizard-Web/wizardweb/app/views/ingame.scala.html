@(logic: wizard.controller.aGameLogic)(implicit request: play.api.mvc.RequestHeader)
@import helper._

@main("Ingame") {

    @defining((card: wizard.model.cards.Card) => {
        card.value match {
            case wizard.model.cards.Value.WizardKarte => "Wizard.png"
            case wizard.model.cards.Value.Chester => "Jester.png"
            case v =>
                val colorName = card.color.toString
                val number = v.cardType()
                s"${colorName}_${number}.png"
        }
    }) { cardToFile =>

        @defining(request.cookies.get("theme").map(_.value).getOrElse("auto")) { theme =>
            @defining({
                val light = routes.Assets.versioned("images/backgrounds/Wizard_game_background_light.png").url
                val dark = routes.Assets.versioned("images/backgrounds/Wizard_game_background2_GUI.png").url
                if(theme == "light") light else dark
            }) { bgUrl =>

                <main>
                    <div class="game__main bg-ingame" style="background-image: url('@bgUrl')">
                        <div class="container">
                            <div class="row">
                                <div class="col-4 col-md-3">
                                    @logic.getTrumpCard.map { trump =>
                                    <section class="game__section game__section--trump" aria-label="Trumpf">
                                        <div class="title">Trumpf:
                                            @{
                                                trump.value match {
                                                    case wizard.model.cards.Value.WizardKarte => "Wizard"
                                                    case wizard.model.cards.Value.Chester => "Jester"
                                                    case _ => trump.color.toString
                                                }
                                            }
                                            </div>
                                        <div>
                                            <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(trump))' alt='@trump.toString' />
                                        </div>
                                    </section>
                                    }.getOrElse {
                                        <section class="game__section game__section--trump" aria-label="Trumpf">
                                            <div class="title">Trumpf: —</div>
                                        </section>
                                    }
                                </div>
                                <div class="col-8 col-md-6">
                                @logic.getTrickCards.filter(_.nonEmpty).map { cards =>
                                <section class="game__section" aria-label="Aktueller Stich">
                                    <div class="title">Aktueller Stich:</div>
                                    <div style="display: flex">
                                        @for(card <- cards) {
                                            <card class="px-1">
                                                <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />
                                            </card>
                                        }
                                    </div>
                                </section>
                                }.getOrElse {
                                    <section class="game__section" aria-label="Aktueller Stich">
                                        <div class="title">Aktueller Stich:</div>
                                    </section>
                                }
                                </div>
                                <div class="col col-md-3">
                                @logic.getPlayer.map { players =>
                                    <section class="game__section game__section--scoreboard" aria-label="Scoreboard">
                                        <div class="game__scoreboard">
                                            <div class="title">Runde</div>
                                            <div class="score-grid">
                                                <div class="hdr">Spieler</div>
                                                <div class="hdr">Bid</div>
                                                <div class="hdr">Punkte</div>
                                                @for(p <- players) {
                                                    <div>@p.name</div>
                                                    <div class="val">@p.roundBids</div>
                                                    <div class="val">@p.points</div>
                                                }
                                            </div>
                                        </div>
                                    </section>
                                }
                                </div>
                        </div>
                    </div>
                    <div class="container">
                        @logic.getPlayer.foreach { players =>
                            <div class="row py-1">
                                <section class="game__section" aria-label="Spielerübersicht">
                                    <div class="title">Spieler:</div>
                                    <div>@players.map(_.name).mkString(", ")</div>
                                </section>
                            </div>
                        }

                        @for(player <- logic.getPlayer.getOrElse(Nil)) {
                            <div class="row py-1">
                            <section class="game__section game__hand" aria-label="Hand von @player.name">
                                <form action="@routes.HomeController.bid()" method="post">
                                    @CSRF.formField
                                <input type="hidden" name="returnTo" value="@request.uri">

                                <div class="d-flex gap-2 p-1">
                                    <div class="player-name">@player.name</div>
                                    <label for="bid" class="form-label"></label>
                                    <input type="number" class="form-control" id="bid" placeholder="Bid" name="bid" required>
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                                </form>
                                <div class="d-flex gap-2 p-1">
                                @for((card, idx) <- player.hand.cards.zipWithIndex) {
                                    <card class="card md-3">
                                        <form action="@("/demo_input/" + (idx + 1))" method="get" style="display:inline;">
                                            <input type="hidden" name="returnTo" value="@request.uri">
                                            <button type="submit" class="dropdown-item">
                                                <img class="img-fluid" loading="lazy" src='@routes.Assets.versioned("images/cards/" + cardToFile(card))' alt='@card.toString' />
                                            </button>
                                        </form>
                                    </card>

                                }
                                </div>
                            </section>
                            </div>
                        }
                    </div>

                    </div>
                    </main>

            }
        }
    }
}